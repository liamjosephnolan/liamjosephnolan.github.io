
<h1>Average Capacity Over Time</h1>

<select id="daySelector">
  <option value="" disabled selected>Select a Day</option>
  <option value="Monday">Monday</option>
  <option value="Tuesday">Tuesday</option>
  <option value="Wednesday">Wednesday</option>
  <option value="Thursday">Thursday</option>
  <option value="Friday">Friday</option>
  <option value="Saturday">Saturday</option>
  <option value="Sunday">Sunday</option>
</select>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const API_URL = 'https://ki-webfetch.onrender.com/api/average_capacity';
  const daysInOrder = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
  let allData = {};

  // init charts separately
  const ctx = document.getElementById('myChart').getContext('2d');
  const chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [],
      datasets: [{
        label: 'Average Capacity',
        data: [],
        borderColor: 'rgba(75, 192, 192, 1)',
        backgroundColor: 'rgba(75, 192, 192, 0.2)',
        borderWidth: 2,
        fill: true
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          title: {display: true, text: 'Capacity'}
        },
        x: {
          title: {display: true, text: 'Time'}
        }
      }
    }
  });

  // get today's weekday
  const todayIndex = new Date().getDay(); // 0 (Sunday) - 6 (Saturday)
  const today = daysInOrder[todayIndex + 1]; // +1 to fix da relation

  fetch(API_URL)
    .then(response => {
      if (!response.ok) throw new Error('Failed to fetch API data');
      return response.json();
    })
    .then(data => {
      // i guess same transformation u did?
      allData = data.reduce((acc, day) => {
        acc[day.DayOfWeek] = day.Data;
        return acc;
      }, {});

      // default select to today
      document.getElementById('daySelector').value = today;

      // default chart to today's data
      if (allData[today]) updateChart(today);
      else console.warn('No data available for today:', today);
    })
    .catch(error => {
      console.error('Error fetching data:', error);
      document.body.innerHTML += '<h2>Error loading data. Please try again later.</h2>';
    });

  // update chart on Day selection
  document.getElementById('daySelector').addEventListener('change', event => {
    const selectedDay = event.target.value;
    if (!selectedDay || !allData[selectedDay]) return;

    updateChart(selectedDay);
  });

  function updateChart(day) {
    const dayData = allData[day] || [];
    chart.data.labels = dayData.map(entry => entry.TimeOfDay);
    chart.data.datasets[0].data = dayData.map(entry => entry.Capacity);
    chart.update();
  }
</script>
